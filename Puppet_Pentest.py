# This script checks for Access Issues, Information Disclosure realted to Puppet Server

import requests
import urllib3

# Disable InsecureRequestWarning for SSL - Verify= False
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# Update your Server address here
puppet_server_host = "127.0.0.1"

urls = [
    f"https://{puppet_server_host}:8140/status/v1/simple",
    f"https://{puppet_server_host}:8140/status/v1/services",
    f"https://{puppet_server_host}:8140/status/v1/services?level=debug",
    f"https://{puppet_server_host}:8140/metrics/v2/version",
    f"https://{puppet_server_host}:8140/features",
    f"https://{puppet_server_host}:8140/puppet",
    f"https://{puppet_server_host}:8140/puppet-ca",
    f"https://{puppet_server_host}:8140/metrics/v2/read/java.util.logging:type=Logging/LoggerNames",
    f"https://{puppet_server_host}:8140/metrics/v2/list",
    f"https://{puppet_server_host}:8140/metrics/v2/read/java.lang:name=*,type=GarbageCollector/CollectionCount,CollectionTime",
    f"https://{puppet_server_host}:8140/puppet-ca/v1/certificate_request/puppet",
    f"https://{puppet_server_host}:8140/puppet-ca/v1/certificate_request/:nodename?environment=:environment",
    f"https://{puppet_server_host}:8140/puppet-ca/v1/certificate_requests/ignored",
    f"https://{puppet_server_host}:8140/puppet-ca/v1/certificate_revocation_list/ca",
    f"https://{puppet_server_host}:8140/puppet-admin-api/v1/jruby-pool/thread-dump",
    f"https://{puppet_server_host}:8140/puppet-admin-api/v1/environment-cache",
    f"https://{puppet_server_host}:8140/puppet-admin-api/v1/jruby-pool",
    f"https://{puppet_server_host}:8140/puppet-admin-api/v1/jruby-pool/thread-dump",
    f"https://{puppet_server_host}:8140/puppet/v3/static_file_content/modules/example/files/data.txt?code_id=urn:puppet:code-id:1:67eb71417fbd736a619c8b5f9bfc0056ea8c53ca;production&environment=production",
    f"https://{puppet_server_host}:8140/metrics/v1/mbeans",
    f"https://{puppet_server_host}:8140/metrics/v1/mbeans/java.lang:type=Memory",
    f"http://{puppet_server_host}:8140/metrics/v1/mbeans",
]

for url in urls:
    response = requests.get(url, verify=False) 
    response_data = response.content
    content_type = response.headers.get("content-type")

    if content_type and "text" in content_type:
            decode = response_data.decode("utf-8")
            output = f"Url is {url}, Status Code is {response}, Response Body is {decode} \n\n\n"
            print(output)
    else:
        output = f"Url is {url}, Status Code is {response}, Response Body is {response_data}\n\n\n"
        print(output)
