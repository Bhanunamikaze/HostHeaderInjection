#!/bin/bash

# Function to run the ntpq command and save output to a file
run_ntpq_command() {
    local command=$1
    local ip_address=$2
    echo "Running: ntpq -c $command $ip_address"
    {
        echo "--------------------------------------"
        echo "Output of ntpq -c $command $ip_address:"
        echo "--------------------------------------"
        ntpq -c "$command" "$ip_address"
        echo ""
    } >> ntp_output.txt 2>&1
}

# Check if IP address is provided as an argument
if [ -z "$1" ]; then
    echo "Usage: $0 <IP_Address>"
    exit 1
fi

IP_ADDRESS=$1

# List of commands to run
commands=(
    mreadlist readvar
    addvars mreadvar
    apeers mrl rl
    associations host mrulist rmvars
    authenticate hostnames mrv rv
    authinfo ntpversion saveconfig
    cl iostats opeers showvars
    clearvars kerninfo passociations sysinfo
    clocklist keyid sysstats
    clockvar keytype peers timeout
    config-from-file lassociations poll timerstats
    cooked lopeers pstats version
    cv lpassociations quit writelist
    debug lpeers raw writevar
    delay monstats readlist
)

# Empty the output file before writing
> ntp_output.txt

# Run each command
for command in "${commands[@]}"; do
    run_ntpq_command "$command" "$IP_ADDRESS"
done

echo "All commands executed. Output saved to ntp_output.txt."
